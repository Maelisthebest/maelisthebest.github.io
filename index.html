<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Login / Registrierung</title>
</head>
<body style="font-family: Arial; padding: 20px; background: #f0f2f5;">
    <div style="max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h2>Registrierung</h2>
        <input type="text" id="regUsername" placeholder="Username" style="width: 90%; padding: 8px; margin-bottom: 10px;">
        <input type="password" id="regPassword" placeholder="Passwort" style="width: 90%; padding: 8px; margin-bottom: 10px;">
        <button id="btnRegister" style="width: 95%; padding: 10px; background: #007bff; color: white; border: none; cursor: pointer;">Registrieren</button>
        <p id="regMessage" style="color: red; font-size: 14px;"></p>

        <hr style="margin: 20px 0;">

        <h2>Login</h2>
        <input type="text" id="loginUsername" placeholder="Username" style="width: 90%; padding: 8px; margin-bottom: 10px;">
        <input type="password" id="loginPassword" placeholder="Passwort" style="width: 90%; padding: 8px; margin-bottom: 10px;">
        <button id="btnLogin" style="width: 95%; padding: 10px; background: #28a745; color: white; border: none; cursor: pointer;">Login</button>
        <p id="loginMessage" style="color: red; font-size: 14px;"></p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCp6Aon4b-sLmUdRaf3sdyKN0y4QK2Zil4",
            authDomain: "maelist-chat.firebaseapp.com",
            databaseURL: "https://maelist-chat-default-rtdb.firebaseio.com/",
            projectId: "maelist-chat",
            storageBucket: "maelist-chat.firebasestorage.app",
            messagingSenderId: "87392900284",
            appId: "1:87392900284:web:fd39fe7161bfa828976cb9"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        document.getElementById('btnRegister').onclick = async () => {
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            if(!username || password.length < 6) return alert("Username nÃ¶tig & Passwort mind. 6 Zeichen");

            try {
                const cred = await createUserWithEmailAndPassword(auth, username.toLowerCase() + "@local.fake", password);
                await Promise.all([
                    set(ref(db, 'users/' + cred.user.uid), { username: username }),
                    set(ref(db, 'usernames/' + username), cred.user.uid)
                ]);
                window.location.href = "chat.html";
            } catch(err) { document.getElementById('regMessage').textContent = err.message; }
        };

        document.getElementById('btnLogin').onclick = async () => {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            try {
                await signInWithEmailAndPassword(auth, username.toLowerCase() + "@local.fake", password);
                window.location.href = "chat.html";
            } catch(err) { document.getElementById('loginMessage').textContent = "Login fehlgeschlagen!"; }
        };
    </script>
</body>
</html>
