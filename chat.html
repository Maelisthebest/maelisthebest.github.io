<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Chat</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body { font-family: Arial; margin:20px; }
#chatBox { border:1px solid #ccc; height:300px; overflow-y:auto; padding:5px; margin-bottom:10px; }
input, button { padding:5px; margin:5px; }
</style>
</head>
<body>

<h2>ðŸ’¬ Chat Home</h2>
<p>Willkommen, <span id="username"></span>!</p>
<button onclick="logout()">Abmelden</button>

<h3>Ã–ffentlicher Chat</h3>
<div id="chatBox"></div>
<input type="text" id="msgInput" placeholder="Nachricht...">
<button onclick="sendMessage()">Senden</button>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCp6Aon4b-sLmUdRaf3sdyKN0y4QK2Zil4",
  authDomain: "maelist-chat.firebaseapp.com",
  databaseURL: "https://maelist-chat-default-rtdb.firebaseio.com/",
  projectId: "maelist-chat",
  storageBucket: "maelist-chat.firebasestorage.app",
  messagingSenderId: "87392900284",
  appId: "1:87392900284:web:fd39fe7161bfa828976cb9",
  measurementId: "G-GK0KNPV152"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
let uid = null;
let username = "";

// PrÃ¼fen ob eingeloggter User
auth.onAuthStateChanged(user => {
  if(!user){
    window.location.href = "index.html"; // nicht eingeloggt â†’ zurÃ¼ck
  } else {
    uid = user.uid;
    db.ref('users/' + uid).once('value').then(snap => {
      username = snap.val().username;
      document.getElementById('username').textContent = username;
      loadPublicChat();
    });
  }
});

// Ã–ffentlichen Chat laden
function loadPublicChat(){
  const chatBox = document.getElementById('chatBox');
  db.ref('chats/public/messages').on('child_added', snap => {
    const data = snap.val();
    const div = document.createElement('div');
    div.textContent = `${data.from}: ${data.text}`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  });
}

// Nachricht senden
function sendMessage(){
  const text = document.getElementById('msgInput').value;
  if(!text) return;
  const msgRef = db.ref('chats/public/messages').push();
  msgRef.set({ from: username, text: text, timestamp: Date.now() });
  document.getElementById('msgInput').value = "";
}

// Logout
function logout(){
  auth.signOut().then(() => window.location.href="index.html");
}
</script>
</body>
</html>
